<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>F.O.M. ‚ù§Ô∏è</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #ffb6c1;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    canvas {
      border: 3px solid #ff4d6d;
      border-radius: 12px;
      box-shadow: 0 0 18px rgba(0,0,0,.35);
    }
  </style>
</head>
<body>
<script>
let personagemSelecionado = null;
const isMobile = /Mobi|Android/i.test(navigator.userAgent);

/* ================= MENU ================= */
class Menu extends Phaser.Scene {
  constructor(){ super({ key:'Menu' }); }
  preload(){
    this.load.image('fundo_menu', 'imagens/fundo_menu.png');
  }
  create(){
    if (this.textures.exists('fundo_menu')) {
      this.add.image(800, 450, 'fundo_menu').setDisplaySize(1600,900);
    } else {
      this.add.rectangle(800, 450, 1600, 900, 0xcfd8dc);
    }
    this.add.text(800, 220, "First of Many ‚ù§Ô∏è", { fontSize:'64px', fill:'#000' }).setOrigin(0.5);

    const start = this.add.text(800, 520, "‚ñ∂ Come√ßar", { fontSize:'48px', fill:'#000' })
      .setOrigin(0.5).setInteractive();
    start.on('pointerdown', () => this.scene.start('EscolhaPersonagem'));

    const controls = this.add.text(800, 610, "‚öôÔ∏è Controles", { fontSize:'40px', fill:'#000' })
      .setOrigin(0.5).setInteractive();
    controls.on('pointerdown', () => {
      const bg = this.add.rectangle(800, 450, 740, 380, 0xffffff, 0.96).setStrokeStyle(4, 0x333333);
      const t1 = this.add.text(800, 340, "Controles", { fontSize:'48px', fill:'#000' }).setOrigin(0.5);
      const t2 = this.add.text(
        800, 450,
        "‚Üê ‚Üí  ou  A D : Andar\n‚Üë  ou  W  ou  ESPA√áO : Pular\nüì± Toque no mobile: bot√µes na tela",
        { fontSize:'30px', fill:'#000', align:'center' }
      ).setOrigin(0.5);
      const fechar = this.add.text(800, 560, "Fechar", { fontSize:'36px', fill:'#000' })
        .setOrigin(0.5).setInteractive();
      fechar.on('pointerdown', () => { bg.destroy(); t1.destroy(); t2.destroy(); fechar.destroy(); });
    });
  }
}

/* ========== ESCOLHA PERSONAGEM ========== */
class EscolhaPersonagem extends Phaser.Scene {
  constructor(){ super({ key:'EscolhaPersonagem' }); }
  preload(){
    this.load.image('imgGabriel', 'imagens/gabriel.png');
    this.load.image('imgThaina',  'imagens/thaina.png');
  }
  create(){
    this.add.rectangle(800, 450, 1600, 900, 0xcfd8dc);

    this.add.text(800, 120, "Escolha seu personagem", { fontSize:'56px', fill:'#000' }).setOrigin(0.5);

    this.add.image(600, 360, 'imgGabriel').setScale(1.5);
    const btnG = this.add.text(600, 560, "üë¶ Gabriel", { fontSize:'48px', fill:'#000' })
      .setOrigin(0.5).setInteractive();

    this.add.image(1000, 360, 'imgThaina').setScale(1.5);
    const btnT = this.add.text(1000, 560, "üë© Thain√°", { fontSize:'48px', fill:'#000' })
      .setOrigin(0.5).setInteractive();

    const iniciarCom = (p) => {
      personagemSelecionado = p;
      this.scene.start('Fase0');
    };
    btnG.on('pointerdown', () => iniciarCom('gabriel'));
    btnT.on('pointerdown', () => iniciarCom('thaina'));
  }
}

/* ================= BASE DAS FASES ================= */
class BaseFase extends Phaser.Scene {
  constructor(key, proximaFase, mensagem){
    super({ key });
    this.proximaFase = proximaFase;
    this.mensagem = mensagem;
    this.mobileControls = { left:false, right:false, jump:false };
  }

  preload(){
    this.load.image('chao', 'imagens/rpgTile133.png');
    this.load.spritesheet('gabrielSprite','imagens/gabrielSprite.png',{frameWidth:31,frameHeight:42});
    this.load.spritesheet('thainaSprite', 'imagens/thainaSprite.png', {frameWidth:31,frameHeight:42});
    this.load.image('quadro','imagens/quadro.png');
  }

  create(){
    this.add.rectangle(800, 450, 1600, 900, 0xcfd8dc);

    // ch√£o
    const tileW = this.textures.get('chao').getSourceImage().width;
    const tilesNec = Math.ceil(1600/tileW)+2;
    const plataformas = this.physics.add.staticGroup();
    for(let i=0;i<tilesNec;i++){
      plataformas.create(i*tileW,880,'chao').setOrigin(0,0).refreshBody();
    }

    // jogador
    const spriteKey = personagemSelecionado==='gabriel' ? 'gabrielSprite':'thainaSprite';
    this.jogador = this.physics.add.sprite(100,720,spriteKey).setScale(2.3);
    this.jogador.setCollideWorldBounds(true);
    this.physics.add.collider(this.jogador, plataformas);

    if(!this.anims.exists('left_'+spriteKey)){
      this.anims.create({key:'left_'+spriteKey,frames:this.anims.generateFrameNumbers(spriteKey,{start:0,end:3}),frameRate:10,repeat:-1});
      this.anims.create({key:'turn_'+spriteKey,frames:[{key:spriteKey,frame:4}],frameRate:20});
      this.anims.create({key:'right_'+spriteKey,frames:this.anims.generateFrameNumbers(spriteKey,{start:5,end:8}),frameRate:10,repeat:-1});
    }

    this.cursors=this.input.keyboard.createCursorKeys();
    this.keys=this.input.keyboard.addKeys({
      up:Phaser.Input.Keyboard.KeyCodes.W,
      left:Phaser.Input.Keyboard.KeyCodes.A,
      right:Phaser.Input.Keyboard.KeyCodes.D,
      space:Phaser.Input.Keyboard.KeyCodes.SPACE,
      skip:Phaser.Input.Keyboard.KeyCodes.P
    });

    this.add.text(16,16,this.mensagem,{fontSize:'28px',fill:'#000'});

    // Bot√µes mobile
    if(isMobile){
      const btnSize=120;
      this.btnLeft=this.add.rectangle(120,780,btnSize,btnSize,0xffffff,0.3).setInteractive();
      this.add.text(120,780,"‚¨ÖÔ∏è",{fontSize:"48px",fill:"#000"}).setOrigin(0.5);

      this.btnRight=this.add.rectangle(280,780,btnSize,btnSize,0xffffff,0.3).setInteractive();
      this.add.text(280,780,"‚û°Ô∏è",{fontSize:"48px",fill:"#000"}).setOrigin(0.5);

      this.btnJump=this.add.rectangle(1480,780,btnSize,btnSize,0xffffff,0.3).setInteractive();
      this.add.text(1480,780,"‚¨ÜÔ∏è",{fontSize:"48px",fill:"#000"}).setOrigin(0.5);

      this.btnLeft.on('pointerdown',()=>this.mobileControls.left=true);
      this.btnLeft.on('pointerup',()=>this.mobileControls.left=false);
      this.btnLeft.on('pointerout',()=>this.mobileControls.left=false);

      this.btnRight.on('pointerdown',()=>this.mobileControls.right=true);
      this.btnRight.on('pointerup',()=>this.mobileControls.right=false);
      this.btnRight.on('pointerout',()=>this.mobileControls.right=false);

      this.btnJump.on('pointerdown',()=>this.mobileControls.jump=true);
      this.btnJump.on('pointerup',()=>this.mobileControls.jump=false);
      this.btnJump.on('pointerout',()=>this.mobileControls.jump=false);
    }
  }

  update(){
    const spriteKey = personagemSelecionado==='gabriel' ? 'gabrielSprite':'thainaSprite';
    const left=this.cursors.left.isDown||this.keys.left.isDown||this.mobileControls.left;
    const right=this.cursors.right.isDown||this.keys.right.isDown||this.mobileControls.right;
    const jump=(this.cursors.up.isDown||this.keys.up.isDown||this.keys.space.isDown||this.mobileControls.jump);

    if(left){this.jogador.setVelocityX(-200);this.jogador.anims.play('left_'+spriteKey,true);}
    else if(right){this.jogador.setVelocityX(200);this.jogador.anims.play('right_'+spriteKey,true);}
    else{this.jogador.setVelocityX(0);this.jogador.anims.play('turn_'+spriteKey);}

    if(jump&&this.jogador.body.blocked.down){this.jogador.setVelocityY(-600);}
  }
}

/* FASES SIMPLES EXEMPLO */
class Fase0 extends BaseFase{constructor(){super("Fase0","Fase1","Fase 0: O come√ßo ‚ù§Ô∏è");}}
class Fase1 extends BaseFase{constructor(){super("Fase1","Fase2","Fase 1: Continuando ‚ù§Ô∏è");}}
class Fase2 extends BaseFase{constructor(){super("Fase2","Fase3","Fase 2: Mais dif√≠cil ‚ù§Ô∏è");}}
class Fase3 extends BaseFase{constructor(){super("Fase3",null,"Fase 3 ‚ù§Ô∏è");}}

/* CONFIG */
const config={
  type:Phaser.AUTO,
  width:isMobile?window.innerWidth:1600,
  height:isMobile?window.innerHeight:900,
  scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},
  pixelArt:true,
  physics:{default:'arcade',arcade:{gravity:{y:600},debug:false}},
  scene:[Menu,EscolhaPersonagem,Fase0,Fase1,Fase2,Fase3]
};
new Phaser.Game(config);
</script>
</body>
</html>
